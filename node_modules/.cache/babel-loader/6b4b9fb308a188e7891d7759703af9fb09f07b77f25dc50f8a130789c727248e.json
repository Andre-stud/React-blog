{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nconst arr = [];\nexport const fetchTickets = createAsyncThunk('tickets/fetchTickets', async (_, _ref) => {\n  let {\n    rejectWithValue,\n    dispatch\n  } = _ref;\n  try {\n    const responseId = await fetch('https://aviasales-test-api.kata.academy/search');\n    if (!responseId.ok) {\n      throw new Error('responseId error');\n    }\n    const searchId = await responseId.json();\n\n    // eslint-disable-next-line no-inner-declarations\n    async function recurTicked() {\n      try {\n        const responseTickets = await fetch(`https://aviasales-test-api.kata.academy/tickets?searchId=${searchId.searchId}`);\n        if (!responseTickets.ok) {\n          throw new Error('responseTickets error');\n        }\n        const ticketsData = await responseTickets.json();\n        if (ticketsData.stop !== true) {\n          arr.push(...ticketsData.tickets);\n          recurTicked();\n        }\n        if (ticketsData.stop === true) {\n          // eslint-disable-next-line no-use-before-define\n          return dispatch(updateTickets(arr));\n        }\n        return ticketsData.tickets;\n      } catch (error) {\n        recurTicked();\n        return rejectWithValue(error.message);\n      }\n    }\n    return await recurTicked();\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nconst ticketsSlice = createSlice({\n  name: 'tickets',\n  initialState: {\n    tickets: [],\n    ticketsData: [],\n    status: null,\n    error: null\n  },\n  reducers: {\n    updateTickets(state, actions) {\n      state.tickets = actions.payload;\n    },\n    updateDataTickets(state, actions) {\n      state.ticketsData = actions.payload;\n    }\n  },\n  extraReducers: {\n    [fetchTickets.pending]: state => {\n      state.status = 'loading';\n      state.error = null;\n    },\n    [fetchTickets.fulfilled]: (state, actions) => {\n      state.status = 'resolved';\n      state.tickets = actions.payload;\n    },\n    [fetchTickets.rejected]: (state, actions) => {\n      state.status = 'rejected';\n      state.error = actions.payload;\n    }\n  }\n});\nexport const {\n  updateTickets,\n  updateDataTickets\n} = ticketsSlice.actions;\nexport default ticketsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","arr","fetchTickets","_","_ref","rejectWithValue","dispatch","responseId","fetch","ok","Error","searchId","json","recurTicked","responseTickets","ticketsData","stop","push","tickets","updateTickets","error","message","ticketsSlice","name","initialState","status","reducers","state","actions","payload","updateDataTickets","extraReducers","pending","fulfilled","rejected","reducer"],"sources":["/Users/andre/Desktop/blog/src/components/store/tickets-slice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\n\nconst arr = [];\n\nexport const fetchTickets = createAsyncThunk('tickets/fetchTickets', async (_, { rejectWithValue, dispatch }) => {\n  try {\n    const responseId = await fetch('https://aviasales-test-api.kata.academy/search');\n\n    if (!responseId.ok) {\n      throw new Error('responseId error');\n    }\n\n    const searchId = await responseId.json();\n\n    // eslint-disable-next-line no-inner-declarations\n    async function recurTicked() {\n      try {\n        const responseTickets = await fetch(\n          `https://aviasales-test-api.kata.academy/tickets?searchId=${searchId.searchId}`\n        );\n\n        if (!responseTickets.ok) {\n          throw new Error('responseTickets error');\n        }\n\n        const ticketsData = await responseTickets.json();\n\n        if (ticketsData.stop !== true) {\n          arr.push(...ticketsData.tickets);\n          recurTicked();\n        }\n        if (ticketsData.stop === true) {\n          // eslint-disable-next-line no-use-before-define\n          return dispatch(updateTickets(arr));\n        }\n\n        return ticketsData.tickets;\n      } catch (error) {\n        recurTicked();\n        return rejectWithValue(error.message);\n      }\n    }\n\n    return await recurTicked();\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\n\nconst ticketsSlice = createSlice({\n  name: 'tickets',\n  initialState: {\n    tickets: [],\n    ticketsData: [],\n    status: null,\n    error: null,\n  },\n  reducers: {\n    updateTickets(state, actions) {\n      state.tickets = actions.payload;\n    },\n    updateDataTickets(state, actions) {\n      state.ticketsData = actions.payload;\n    },\n  },\n  extraReducers: {\n    [fetchTickets.pending]: (state) => {\n      state.status = 'loading';\n      state.error = null;\n    },\n    [fetchTickets.fulfilled]: (state, actions) => {\n      state.status = 'resolved';\n      state.tickets = actions.payload;\n    },\n    [fetchTickets.rejected]: (state, actions) => {\n      state.status = 'rejected';\n      state.error = actions.payload;\n    },\n  },\n});\n\nexport const { updateTickets, updateDataTickets } = ticketsSlice.actions;\nexport default ticketsSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}